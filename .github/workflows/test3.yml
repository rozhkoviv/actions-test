name: Test3

on:
  workflow_dispatch:
  repository_dispatch:
    types:
      - run_tests

jobs:
  tests:
    runs-on: ubuntu-latest
    permissions: write-all
    steps:
    - name: Debug
      env:
        GITHUB_CONTEXT: ${{ github.ref_name }}
      run: |
        echo "$GITHUB_CONTEXT"
    - name: List branch pull requests
      env:
        HEAD_REF_NAME: ${{ github.ref_name}}
        CURRENT_REPOSITORY: ${{ github.repository }}
      run: |
        curl \
        -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" \
        -H "Accept: application/vnd.github+json" \
        -H "Content-Type: application/json" \
        https://api.github.com/repos/"$CURRENT_REPOSITORY"/pulls?head="$HEAD_REF_NAME" > \
        pulls.json
    - name: output
      run: cat pulls.json
    - name: Update status
      if: github.event.client_payload.pr_number
      uses: thollander/actions-comment-pull-request@v2
      with:
        pr_number: ${{ github.event.client_payload.pr_number }}
        message: |
          Tests running ...
    - name: Test 3
      run: |
        echo "${{ github.event.client_payload.env }}"
    - name: Update status
      if: github.event.client_payload.pr_number
      uses: thollander/actions-comment-pull-request@v2
      with:
        pr_number: ${{ github.event.client_payload.pr_number }}
        message: |
          Tests passed!